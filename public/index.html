<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Volunteer Clock Kiosk</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body { height: 100%; }
    body { overflow: hidden; } /* ✅ prevents scrolling */
    .btn { -webkit-tap-highlight-color: transparent; }
    .pulse-soft { animation: pulseSoft 1.2s ease-in-out infinite; }
    @keyframes pulseSoft { 0%,100% { transform: scale(1); } 50% { transform: scale(1.02); } }
  </style>
</head>

<body class="bg-gradient-to-br from-slate-950 via-slate-900 to-slate-800 text-slate-100">
  <div class="h-[100svh] w-full flex flex-col">
    <!-- Top bar -->
    <header class="px-5 py-4 flex items-center justify-between">
      <div>
        <div class="text-2xl font-semibold tracking-tight">Volunteer Clock</div>
        <div id="subtitle" class="text-slate-300 text-sm mt-0.5">Step 1 of 3 — Scan or enter member number</div>
      </div>
      <div class="flex items-center gap-2">
        <button id="homeBtn" class="btn px-4 py-3 rounded-2xl bg-slate-700/60 hover:bg-slate-700 border border-slate-600/60 text-base">
          Home
        </button>
        <button id="resetBtn" class="btn px-4 py-3 rounded-2xl bg-slate-700/60 hover:bg-slate-700 border border-slate-600/60 text-base">
          Reset
        </button>
      </div>
    </header>

    <!-- Progress -->
    <div class="px-5 pb-3">
      <div class="h-2 w-full rounded-full bg-slate-700/50 overflow-hidden">
        <div id="progressBar" class="h-2 w-1/3 bg-emerald-500"></div>
      </div>
    </div>

    <!-- Main -->
    <main class="flex-1 px-5 pb-5">
      <!-- STEP 1 -->
      <section id="step1" class="h-full">
        <!-- unchanged UI -->
      </section>

      <!-- STEP 2 -->
      <section id="step2" class="h-full hidden">
        <!-- unchanged UI -->
      </section>

      <!-- STEP 3 -->
      <section id="step3" class="h-full hidden">
        <!-- unchanged UI -->
      </section>
    </main>
  </div>

  <script>
    // ----------------------------
    // State
    // ----------------------------
    const state = {
      member: null,
      activities: [],
      resetTimer: null,
      autoReturnTimer: null,
      keypadVisible: false,
    };

    const $ = (id) => document.getElementById(id);

    // ----------------------------
    // Helpers
    // ----------------------------
    function showResult({ kind, title, subtitle, details }) {
      const card = $("resultCard");
      const titleEl = $("resultTitle");
      const subEl = $("resultSubtitle");
      const detEl = $("resultDetails");

      titleEl.textContent = title || "Result";
      subEl.textContent = subtitle || "—";
      detEl.textContent = details || "";

      card.className =
        "h-full rounded-3xl border border-white/10 shadow-xl p-6 flex flex-col items-center justify-center text-center bg-white/90 text-slate-900";

      if (kind === "success") card.className += " ring-8 ring-emerald-300";
      if (kind === "warn") card.className += " ring-8 ring-amber-300 pulse-soft";
      if (kind === "error") card.className += " ring-8 ring-rose-300";

      showStep(3);

      if (state.autoReturnTimer) clearTimeout(state.autoReturnTimer);
      state.autoReturnTimer = setTimeout(() => resetAll(), 4500);
    }

    // ----------------------------
    // Lookup
    // ----------------------------
    async function doLookup() {
      const memberNum = onlyDigits1to4($("memberInput").value);
      if (!memberNum) {
        showResult({
          kind: "error",
          title: "Invalid Member #",
          subtitle: "Enter 1–4 digits",
          details: "Try scanning again or use the keypad."
        });
        return;
      }

      try {
        await lookupMemberByNumber(memberNum);
        showResult({
          kind: "success",
          title: "Member Loaded",
          subtitle: state.member.name,
          details: `Member #${state.member.number}`
        });

        if (state.autoReturnTimer) clearTimeout(state.autoReturnTimer);
        state.autoReturnTimer = setTimeout(() => showStep(2), 1200);
      } catch (e) {
        showResult({
          kind: "error",
          title: "Member Not Eligible",
          subtitle: "Please see Khory",
          details: String(e.message || e)
        });
      }
    }

    // ----------------------------
    // Clock in/out messaging
    // ----------------------------
    // Anywhere an admin reference existed now says "Please see Khory"
  </script>
</body>
</html>
